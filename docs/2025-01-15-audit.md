# ReconScript Repository Audit (2025-01-15)

## Overview
This document captures the findings from a production-readiness, security, and deployment audit of ReconScript. Each section maps to the requested checklist and records status, evidence, and remediation guidance.

## 1. Repository Structure & Hygiene
- ⚠️ **Tracked artefacts** – Generated scan outputs remain committed under `results/` even though the directory is listed in `.gitignore`, which increases the risk of leaking assessment data and bloats the repo. Remove existing files and keep the directory empty. Apply a placeholder README if needed.  
  Evidence: `results/juice.json`, `results/127-0-0-1-20251016-032315.html`.
- ⚠️ **Orphan vendor shims** – Stub packages for `requests` and `nacl` ship in-tree, but production builds should rely on the pinned third-party libraries instead. Their presence causes the source tree to shadow real dependencies when the project is executed from a clone, diverging from packaged behaviour.

## 2. Dependency Integrity
- ❌ **Package shadowing and duplication** – The source tree vendors its own `requests` and `nacl` modules while `requirements.txt`/`pyproject.toml` pin `requests` and `PyNaCl`. This leads to inconsistent behaviour between editable installs and built wheels, and places cryptography outside of vetted libraries. Remove the stubs or move them behind feature flags/tests.  
  Evidence: `requests/__init__.py`, `requests/api.py`, `nacl/signing.py`.
- ⚠️ **Inconsistent locking** – `requirements.lock` is manually curated and pins versions (e.g., `requests==2.31.0`) that no longer match `requirements.txt` (`requests==2.32.3`), risking downgrade attacks or resolver churn during CI/CD. Align the lock file by regenerating it with the current dependency set.
- ⚠️ **Missing runtime dependency** – `prometheus-client` is required by `reconscript.metrics` but absent from `pyproject.toml`. Add it to the `dependencies` array to keep the packaged project functional.
- ⚠️ **Over-eager bootstrapper** – `install_dependencies.py` attempts to install optional libraries (tabulate, colorama, WeasyPrint stack) regardless of configuration, which fails in restricted networks and slows startup. Restrict installation to the actual runtime requirements or gate extras behind feature flags.

## 3. Build, Test, & Run Validation
- ❌ **Formatting and lint debt** – `black --check` flagged 22 files and `ruff` reported 272 issues, including style problems and security warnings (e.g., `S104` for binding to `0.0.0.0`). Adopt the configured formatters and linters to restore signal in CI.
- ⚠️ **Security tooling unavailable** – `bandit` and `pip-audit` were not runnable in the provided environment due to missing wheels. Ensure these tools are vendored or run inside CI where the network is available, then track their reports.
- ✅ **Unit tests** – `pytest --maxfail=1 --disable-warnings -q` passed (13 tests, 1 skipped) once dependencies already present in the base image were used. No coverage data was produced; configure `pytest-cov` and enforce ≥85% if required.
- ⚠️ **Launcher dependency install** – `start.py` re-invokes `pip install` at runtime and blocks when the environment lacks internet access. Provide an offline mode or documented skip flag.

## 4. Environment & Configuration
- ⚠️ **Default secrets conflict** – `.env.example` ships with `ALLOW_DEV_SECRETS=false` while simultaneously providing placeholder admin credentials. This prevents the UI from starting without manual edits. Either set `ALLOW_DEV_SECRETS=true` for the template or replace the credentials with explicit TODO markers.
- ✅ **Secret path enforcement** – `reconscript.ui` and `reconscript.consent` refuse to use developer keys unless `ALLOW_DEV_SECRETS=true`, preventing accidental deployment of demo material.

## 5. Integration & Connectivity
- ⚠️ **Docker Compose omissions** – `docker-compose.yml` exposes the UI but omits required environment variables (ADMIN_USER/PASSWORD, secret paths). Compose spins up an unusable container by default. Add `.env` support or documented overrides.
- ✅ **HTTP endpoints** – `/healthz` and `/metrics` are implemented in the Flask app; CLI entry points respond to `--help` and dry-run flows succeed in tests.

## 6. Security & Compliance
- ❌ **Custom cryptography** – The vendored `nacl` package re-implements Ed25519 signing and verification. This should be replaced with the audited `PyNaCl` dependency to avoid logic bugs or timing attacks.
- ⚠️ **Secret scanning** – `trufflehog`/`detect-secrets` were unavailable locally. CI should run a secret scan to ensure new commits do not leak credentials.

## 7. Deployment Readiness & Observability
- ⚠️ **CI gaps** – `.github/workflows/ci-matrix.yml` uploads coverage artefacts but never generates coverage data, so uploads are empty. Update pytest invocation to include `--cov` options. Review caching logic for the duplicated `pip install` commands (runtime and dev requirements).
- ⚠️ **Docker reproducibility** – Offline builds will fail because the Dockerfile installs requirements from PyPI at build time. Mirror wheels or provide instructions for air-gapped deployments. Compose also lacks health/ready checks for dependencies beyond the Flask app.

## 8. Recommended Remediations
1. Remove the in-repo `requests/` and `nacl/` packages in favour of official dependencies; update tests to rely on real libraries.
2. Regenerate dependency manifests (`requirements.lock`, `pyproject.toml`) and restrict `install_dependencies.py` to the runtime set.
3. Run `black`, `ruff --fix`, and re-enable security tooling in CI/CD. Configure coverage reporting.
4. Clean committed artefacts under `results/` and tighten `.gitignore`/`.dockerignore` to prevent regressions.
5. Extend Docker Compose/Dockerfile docs to include required environment variables and offline build instructions.
